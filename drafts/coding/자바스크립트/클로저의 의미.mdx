---
title: "클로저의 의미"
date: '2022-11-29'
categories: coding
tags: 자바스크립트
description: 클로저
---
<HeadingNavigator />

### 전략적으로 이해하기
자바스크립트를 기초부터 공부하면서 클로저란 용어만큼 낯설었던 게 없었다.  
리액트 유저라면 밥먹듯이 쓰고 있는 건데 정작 그 개념, 또는 원리에 대해서는 몰랐던 거시다... 그게 무슨 문제지? 라고 생각하는 사람이 있을 테고, 그중 한명이 나였다. 악기를 다룰 줄 알면 되지 만드는 법까지 알아야 하나? 지나치게 배부른 생색내기 아닌가 싶었던 것이다.  
<br/>
하지만 그런 손재주 좋은 사람이 도구를 <i>전략적으로도</i> 이해까지 했을 때, 더 많은 자유가 주어지리란 것은 주지의 사실인 것 같다. 짧은 시간이지만 이를 경험적으로 느꼈고, 어설프게 하지 말자 마음먹었다.  
<br/>
그래서 오늘의 주제는 클로저다.  
하지만 이를 얘기하기 위해서는 먼저 하나의 개념을 알아야 했으니, <q>스코프</q>다.

### 스코프
자바스크립트의 함수는 스코프라는 행동범위를 가지고 있다. 일종의 도화지, 쉽게 보면 함수의 중괄호(`{}`) 영역으로 여길 수도 있을 텐데, <i>`var` 변수의 유효 범위는 함수 스코프다</i>, 라는 말에서 아마 이를 처음 접했던 것 같다.  
<br/>
모든 함수는 이처럼 스코프를 가지고 있다. 가장 최상단에 있는 스코프는 `전역 스코프(global scope)`고, 리액트에서라면 `모듈 스코프(module scope)`가 주 배경을 차지할 것이다.  
<br/>
그러면 이런 말들에서 암시되고 있는 건 뭘까? 그것은 바로 **스코프에는 부피가, 위계가 있다**는 것이다. 스코프는 자기 내부에서 자기가 모르는 어떤 변수가 사용되고 있을 때, 이를 상위 스코프로 거슬러 올라 찾으려고 애쓴다. 이게 <q>스코프 체인(scope chain)</q>이라 불리는 개념이다.  

### 클로저
그래서 클로저란 이런 스코프 체인을 활용한 일종의 함수 테크닉을 의미한다. 그러니까 클로저 함수란 파라미터에도, 그렇다고 함수 내부에도 없는 값을 자기 바깥에서 찾아오는 함수를 의미한다.  
달리 말해 이는 **자식 함수는 부모 함수의 값을 활용할 수 있다는 뜻**이다. 백문이 불여일견이라고 간단한 예시로 클로저의 움직임을 살펴보자
<br/>
```js test.js
  function sum3(x, y, z) {
    return x + y + z;
  }
  
  console.log(sum3(1, 2, 3)) // 6
```
먼저 일반적인 상황이다. 세 개의 파라미터를 받는 함수가 있고, 그 값들은 스코프 안에서 모두 더해져 리턴되고 있다. 여기서 `1, 2, 3`을 인수로 전달했을 때 리턴값이 `6`이라는 걸 상상하기는 그리 어렵지 않을 것이다. 그럼 이를 클로저의 형태로 표현해보자.
<br/>
```js test.js mark=3:5
function sum3(x) {
  return (y) => {
    return (z) => {
      return x + y + z;
    };
  };
}
console.log(sum3(1)(2)(3)) // 6
```
이는 스코프 체인에 의한 클로저의 동작을 보여준다. 가장 깊이 있는 z-함수는 자신의 파라미터 `z`의 값만을 아는 것이 아니다. 그는 스코프 체인에 의해 자기를 품고 있는 상위 스코프를 참조하여, 거기서 `y`를, `x`를 발견하여 가져오고 있다.   
이렇듯 **클로저란 안쪽에서 바깥의 상위 스코프를 참조하는 함수**를 가리킨다.

### 렉시컬 스코프
이때 유의할 점이 있다. 클로저 함수는 호출할 때가 아니라 자기가 선언될 때를 기준으로 스코프 체인을 인식한다. 즉 클로저는 외출할 때 자기가 처음 설계된 자리를 기준으로 인접한 스코프를 찾아가는 것이다. 가령 예를 들면
```js test.js
(function() {
  const x = 1;
  function 클로저선언() {
    console.log(x);
  }
  function 클로저호출(fn) {
    const x = 10;
    fn()
  }
  return 클로저호출(클로저선언)
})()
```
이 IIFE 함수에선 `x` 값이 어떻게 뜨냐가 관건이다. 어떻게 뜰까? 앞서 말했듯 스코프 체인은 함수가 호출되는 곳이 아닌 선언되는 곳를 기준으로 삼는다. 때문에 `클로저선언()`은 자기가 선언된 시점의 바깥 스코프, 그러니까 `const x = 1`이 들어있는 환경을 기억하여 `10`이 아닌 `1`을 출력하게 된다.  
이처럼 자기가 태어난 스코프 환경을 정적으로 또 일관되게 기억하는 것, 그걸 사람들은 <q>렉시컬(스태틱) 스코프</q>라고 부른다.

### 그래서 정리
- 클로저는 `스코프 체인`이라는 거대한 흐름을 이용하는 자바스크립트 함수의 한 속성이다. 여기서 중요한 건 스코프 체인이고, 클로저는 파생물이라면 오만한 말일지도 모르겠다. 어쨌든 난 그렇게 느꼈고, 스코프 체인을 이해하려 노력하면서 컨텍스트나 화살표 함수에 대한 이해도 진전됐다.  
<br/>
1. 함수가 호출될 때마다 함수 컨텍스트가 생성된다.
2. 함수 컨텍스트에는 `변수객체(args, variables), 스코프 체인, this`가 담긴다.
3. 스코프 체인은 함수가 호출되는 곳이 아닌 선언되는 곳을 기준으로 삼는다.
4. 화살표 함수의 컨텍스트에는 `this`가 포함되지 않는다. 자체의 `this`를 바인딩하지 않기 때문에, 스코프 체인에 의해 항상 바깥 스코프의 `this`를 참조한다.